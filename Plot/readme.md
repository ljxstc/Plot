# 软件开发文档
## 1 基本架构
根据软件需求，软件应设计为（C/S）或（B/S）标准结构，C/S即客户端（Client）-服务器（Server），B/S即浏览器（Browser）-服务器（Server）。
其中，使用C/S结构拟采用Visio Studio，基于C#进行客户端软件设计；使用B/S结构拟采用IDEA，基于JAVA进行网页、服务器后端程序设计。  
## 2 C/S结构的设计思路
C/S结构考虑暂时不设置服务器，所有功能通过客户端实现。  
思路： 1.使用winform设计桌面应用程序前端界面；  
	2.通过Matlab计算的图版数据存入MySQL数据库，使用Linq调用数据库；  
	3.C#编写业务逻辑。  
## 3 程序执行流程
	1.载入原始数据
		1.1前端设置打开文件按钮，打开文件夹选择压力恢复数据文件（.xls/.xlsx）
			压力恢复数据应设置为标准格式，数据分两列，第一列为时间，第二列为该时刻压力，即P-T数据 	
		1.2调用ExcelDataReader包，读取Excel文件保存至DataSet  
			调用方法 ExcelProcess.ExcelToDataSet(string excelPath)  
		1.3将DataSet中数据存入动态数组ArrayList，数据类型为字符串string  	
			调用方法 ExcelProcess.DataSetToArrayList(DataSet dt)
		1.4将动态数组拆分成两组数组，分别为压力press和时间time
			调用方法 PressCal.PressAndTime( ArrayList arrayList ,ref double[] time, ref double[] press)
				使用引用参数ref传值
		1.5计算原始压力的压力差
			调用方法 PressCal.ToDelta(double[] press)
		1.6计算压力差的导数
			调用方法 ToDerP(double[] deltaPress,double[] t)
				由于C#没有计算导数的函数，因此采用matlab执行混合编译
				matlab编写函数Derivative(t1,deltaP)，生成dll动态链接库
				C#导入MWArray包用于矩阵计算			
	2.绘制原始数据的压力差-时间曲线
		调用oxyPlot（Nuget包），绘制曲线，要求鼠标点击曲线上的任意一点，给出点的横纵坐标值。
	3.选择样板曲线，并绘制
		3.1载入原始数据曲线后弹出messagebox，提示选择样板曲线 或 在窗口设置下拉列表框，点击后载入样板曲线。
		3.2选择样板曲线后，将数据库的数据加载到计算机内存（考虑内存大小的问题，是否可能影响程序运行）
		3.3调用oxyPlot绘制曲线，与原始数据曲线在同一窗口。
	4.MessageBox提示：拖拽原始数据与样板曲线进行匹配
	5.原始曲线外观设置
		5.1拖拽事件发生后，设置plot控件跟随鼠标移动
		5.2设置控件透明度，除曲线外所有边框背景为透明
		5.3设置控件移动范围，应在窗口范围内
	6.原始曲线与样板曲线拟合
		6.1 考虑到用户误操作，拟合不成功等因素，设置完成拟合按钮，按下后才能进行下一步骤
		6.2 若该样板没有适合的曲线，可选择下拉列表更换样板，重复进行该工作
		6.3 点击匹配完成按钮，提示选择任意匹配点，进行下一步骤。
	7.记录两坐标轴区域的四个坐标值
		7.1 此时程序状态是原始曲线覆盖在样板曲线上，原始曲线外观透明隐藏
		7.2 点击原始曲线，记录该点坐标（曲线上的数值坐标、窗口区域的坐标）
		7.3 后端通过窗口区域的坐标直接计算样板曲线在该点的坐标值（不一定能实现）或 提示点击两次
		7.4 提示是否进行计算，选否返回6
	8.计算完成切换新窗口
		8.1 释放内存，清除所有图版数据；
		8.2 给出所选坐标信息，初始数据信息，计算结果信息
		8.3 返回或退出
## 4 B/S结构思路
B/S结构使用服务器完成后端大量的计算程序，通过网络进行通信，设计web前端页面实现软件操作功能。  
浏览器访问的优势是可以全平台发布，计算机、手机、平板等设备均可访问浏览器执行软件功能。  
思路： 1.使用JAVA-SSM（Spring、SPringMVC、MyBatis）框架编写软件后端  
      2.Spring框架构建标准三层架构，Service层编写业务逻辑  
      3.SpringMVC框架为Controller层，完成socket网络通信功能，实现前后端通信  
      4.MyBatis框架为DAO层，连接MySQL数据库读取数据  
      5.前端使用JSP/Jquery完成动态网页编程，集成BootStrap美化网页外观  
      6.绘图API绘制曲线  
